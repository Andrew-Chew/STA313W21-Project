---
title: "One small change in transportation, one giant leap for the environment"
author: "The (Green)Power Rangers: Ruei-Hung Chen, Andrew Chew, Zhenyu Xuan, Elif Yurek"
date: "16/04/2021"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Install packages used if not already installed.
if (!require("dplyr")) install.packages("dplyr")
if (!require("ggplot2")) install.packages("ggplot2")
if (!require("scales")) install.packages("scales")
if (!require("shiny")) install.packages("shiny")
if (!require("readxl")) install.packages("readxl")
if (!require("highcharter")) install.packages("highcharter")

# Packages used.
library(dplyr)
library(ggplot2)
library(shiny)
library(scales)
library("readxl")
library(highcharter)

# Empty Shiny App template. 
# ui <- fluidPage("")
# server <- function(input, output) {}
# shinyApp(ui = ui, server = server)
```

<!-- Part 1 -->
## Climate Change & CO^2^ 101
<!-- <<<<<<< HEAD -->

```{r}
data <- read_excel("Product/Data/global emission.3.xlsx") 
df <- data.frame( 
  x= data$`Sub-sector`,
  y=data$`Share of global greenhouse gas emissions (%)`) 
df 

df_transport <- df %>% slice(1:5)
df_transport

# Set highcharter options 
options(highcharter.theme = hc_theme_smpl(tooltip = list(valueDecimals = 2))) 

highchart () %>% 
  hc_add_series(
    df, 
    "pie",
    hcaes(
      x = x,
      y = y,
      ),
    name = "CO2 emissions by %"
    )  %>%
  hc_plotOptions(
    series = list(
      showInLegend = FALSE,
      pointFormat = "{point.y}%",
      colorByPoint = TRUE
      )) %>%
  hc_title(
    text = "Total Global CO2 Emissions by Sector in 2016"
    ) 

```







=======

<!-- >>>>>>> fb7782ac83b51eb01196f3b294fbca85be9e9c0e -->

<!-- Part 2 -->
## Unsustainable CO^2^ Emissions
```{r part2 setup, include=FALSE}
part2data <- read.csv("Data/owid-co2-data.csv")
part2clean <- part2data[c("country", "year", "cumulative_co2", "cumulative_gas_co2")]

co2emissions_widget = function(dataset) {

  vars = names(dataset)

  shinyApp(
    ui = fluidPage(
      fluidRow(
        column(4, ),
        plotOutput("co2emissions"),
        column(4, )
      ),
      
      # View selector widget.
      fluidRow(
        column(4, ),
        column(4, radioButtons(
          inputId = "view",
          label = "View:",
          choices = list("Total" = 1, "Gas" = 2), 
          selected = 1,
          inline = TRUE)),
        column(4, )
      ),

      # Country selector widget.
      fluidRow(
        column(4, ),
        column(4, selectInput(
          inputId = "country",
          label = "Country:",
          choices = unique(dataset$country),
          selected = "World")),
        column(4, )
      ),
      
      # Year range slider widget.
      fluidRow(
        style = "padding-bottom: 20px;",
        column(4, ),
        column(4, sliderInput(
          inputId = "years",
          label = "Year Range:",
          # Even though data since 1751 was provided, show data starting from 1900.
          min = 1900,
          max = 2019,
          value = c(1900, 2019),
          step = 1,
          width = "100%",
          sep = "",
          dragRange = TRUE)),
        column(4, ))
    ),

    server = function(input, output, session) {
      
      # Put together dataset based on user selections.
      selected_data <- reactive({
        if (input$view == 1) {
            dataset[, c("country", "year", "cumulative_co2")] %>%
            filter(country == input$country) %>%
            group_by(year) %>%
            filter(year >= input$years[1] & year <= input$years[2]) %>%
            summarise(cum = sum(cumulative_co2, na.rm = TRUE))
        }
        else {
            dataset[, c("country", "year", "cumulative_gas_co2")] %>%
            filter(country == input$country) %>%
            group_by(year) %>%
            filter(year >= input$years[1] & year <= input$years[2]) %>%
            summarise(cum = sum(cumulative_gas_co2, na.rm = TRUE))
        }
      })
      
      
      # You can access the value of the widget with input$date, e.g.
      output$co2emissions <- renderPlot({
        ggplot(selected_data(), aes(x = year, y = cum)) +
          geom_point() +
          geom_path() +
          geom_smooth()
#          scale_y_continuous("Billion Tons", labels = unit_format(scale = 1e-3)) +
#          theme_minimal()
        },
        height = 400,
        width = 600)
    },

    options = list(height = 500)
  )
}
```

```{r part2, echo=FALSE}
co2emissions_widget(part2clean)
```




<!-- Part 3 -->
## What's your "Contribution"?

<!-- Part 4 -->
## How can you help?

<!-- Conclusion -->
## Flatten the curve!
